<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="imagens/Barber Shop Logo.png" type="image/x-icon">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.full.min.js"></script>
    <title>Appointement Book</title>
    <style>
:root {
            --cor0: #654321;
            --cor1: #662C22;
            --cor2: #663822;
            --cor3: #665622;
            --cor4: #664E22;

            --main-bg-color: #f2f2f2;
            --main-font-color: #333;
            --main-button-bg-color: #4CAF50;
            --main-button-color: #ffffff;
            
            --fonte-titulos: 'Playfair Display', serif, Arial, Helvetica, sans-serif;
            --fonte-subtitulos: 'Roboto', sans-serif, Arial, Helvetica, sans-serif;
            --fonte-texto: 'Lora', serif, Arial, Helvetica, sans-serif;
        }

@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&display=swap');        
        /* CSS para o formulário de agendamento */
body {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    margin: 0;
    font-family: Arial, sans-serif;
    background-image: url(imagens/foto-appointement.jpg);
    background-size: cover;
    background-position: center;
}

.container {
    background-color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 280px;
    width: 290px;
}

header {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 20px;
}

header img {
    max-width: 105%;
    height: auto;
}

form {
    width: 800px;
    padding: 20px;
    background-color: #ffffff;
    border-radius: 30px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
}

h1 {
    text-align: center;
    margin-bottom: 20px;
    font-family: 'Orbitron', sans-serif, Arial, Helvetica, sans-serif;
    font-variant: small-caps;
}

label {
    display: block;
    margin: 10px 0 5px;
}

input[type="text"],
input[type="email"],
input[type="date"],
input[type="datetime-local"] {
    width: calc(100% - 20px);
    padding: 10px;
    margin-bottom: 20px;
    border: 1px solid #ddd;
    border-radius: 5px;
}

select {
    width: calc(103% - 20px);
    padding: 10px;
    margin-bottom: 20px;
    border: 1px solid #ddd;
    border-radius: 5px;
}

input[type="submit"] {
    width: 100%;
    padding: 10px;
    border: none;
    background-color: var(--cor0);
    color: #fff;
    border-radius: 5px;
    cursor: pointer;
}

input[type="submit"]:hover {
    background-color: var(--cor4);
}

.xdsoft_datetimepicker {
            font-family: Arial, sans-serif;
            color: var(--main-font-color);
            background-color: var(--main-bg-color);
            width: 100%;
            max-width: 310px;
            border-radius: 8px;
        }
        
        .xdsoft_datetimepicker .xdsoft_datepicker {
            background-color: var(--main-bg-color);
        }
        
        .xdsoft_datetimepicker .xdsoft_timepicker {
            background-color: var(--cor0);
        }
        
        .xdsoft_datetimepicker .xdsoft_calendar td, .xdsoft_datetimepicker .xdsoft_time_box td {
            text-align: center;
        }
        
        .xdsoft_datetimepicker .xdsoft_calendar th, .xdsoft_datetimepicker .xdsoft_time_box th {
            font-weight: normal;
        }
        
        .xdsoft_datetimepicker .xdsoft_calendar td.xdsoft_today, .xdsoft_datetimepicker .xdsoft_time_box td.xdsoft_current {
            background-color: var(--main-button-bg-color);
            color: var(--main-button-color);
        }
        
        .xdsoft_datetimepicker .xdsoft_calendar td.xdsoft_today:before, .xdsoft_datetimepicker .xdsoft_time_box td.xdsoft_current:before {
            background-color: var(--main-button-bg-color);
        }
        
        .xdsoft_datetimepicker .xdsoft_calendar td.xdsoft_disabled, .xdsoft_datetimepicker .xdsoft_time_box td.xdsoft_disabled {
            background-color: #ddd;
        }

        label::After {
            content: '*';
            color: red;
        }
        
        .error-message {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 9999;
        }

        .error-message p {
            color: white;
            font-size: 20px;
            text-align: center;
            max-width: 80%;
            background-color: #f44336;
            padding: 20px;
            border-radius: 5px;
        }

        @media screen and (max-width: 600px) {
            /* Adicione suas regras de estilo para dispositivos com largura máxima de 600px aqui */
            body {
                font-size: 14px;
            }

            .container {
                height: 180px;
                width: 190px;
            }

            form {
                width: 300px;
            }
        }

        @media screen and (max-width: 768px) {
            /* Adicione suas regras de estilo para dispositivos com largura máxima de 768px aqui (para tablets) */
            body {
                font-size: 16px;
            }

            .container {
                height: 220px;
                width: 230px;
            }

            form {
                width: 400px;
            }

            h1 {
                font-size: 28px;
            }
        }

        @media screen and (max-width: 400px) {
            /* Adicione suas regras de estilo para dispositivos com largura máxima de 400px aqui */
            body {
                font-size: 12px;
            }

            .container {
                height: 120px;
                width: 130px;
            }

            form {
                width: 220px;
            }

            h1 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
        <a href="barber-shop.html"><img src="imagens/Barber Shop Logo400.png" alt="Barber Logo"></a>
        </div>
    </header>

    <form id="appointementForm" action="confirmation.html" method="post">
        <h1>Make an Appointement</h1>
        <label for="nome">Name:</label>
        <input type="text" id="nome" name="nome" required placeholder="REQUIRED">
        <label for="email">E-Mail:</label>
        <input type="email" id="email" name="email" required placeholder="REQUIRED">
        <label for="service">Service:</label>
        <select id="service" name="service">
            <optgroup label="For Him">
                <option value="Haircut">Haircut - from 28€</option>
                <option value="Color cut">Color cut - from 60€</option>
                <option value="Beard size">Beard size - from 12€</option>
                <option value="Permanently MEN">Permanently MEN - from 30€</option>
                <option value="Styling Men - Kids">Styling Men - Kids - from 5€</option>
            </optgroup>
            <optgroup label="For Her">
                <option value="Blow-drying">Blow-drying - from 30€</option>
                <option value="Haircut blow-drying">Haircut blow-drying - from 50€</option>
                <option value="Full head tint, cut, blow-drying">Full head tint, cut, blow-drying - from 75€</option>
                <option value="Sun flash, cut, blow-drying">Sun flash, cut, blow-drying - from 95€</option>
                <option value="Foils hightlights, cut, blow-drying">Foils hightlights, cut, blow-drying - from 110€</option>
            </optgroup>
        </select>
        <label for="datetimepicker">Date & Time:</label><span id="datetimeError" style="color: red;"></span>
        <input type="text" id="datetimepicker" name="datetime" required placeholder="REQUIRED">
        <input type="submit" value="Submit">
    </form>

    <div id="confirmationMessage" style="display: none;">
        <p>Appointment Confirmed!</p>
    </div>

    <script>
    document.addEventListener("DOMContentLoaded", function() {
            // Preencher dinamicamente o seletor de serviço
    var serviceSelector = document.getElementById('service');
    var services = document.querySelectorAll('.services h1');

    services.forEach(function(service) {
        var option = document.createElement('option');
        option.value = service.textContent;
        option.textContent = service.textContent;
        serviceSelector.appendChild(option);
    });
});

        var form = document.getElementById('appointmentForm');
        var datetimepicker = document.getElementById('datetimepicker');
        var appointments = JSON.parse(localStorage.getItem('appointments')) || [];

        $(datetimepicker).datetimepicker({
            format: 'Y-m-d H:i',
            formatDate: 'Y-m-d',
            formatTime: 'H:i',
            minDate: 0,
            step: 30,
            allowTimes: getAvailableTimes()
        });

        form.addEventListener('submit', function(e) {
    e.preventDefault();

    var nome = document.getElementById('nome').value;
    var email = document.getElementById('email').value.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
    var datetime = datetimepicker.value;

    if (!nome.trim() || !email.trim()) {
        alert('Por favor, preencha todos os campos.');
        return;
    }

    if (/[^\w.@]/.test(email)) {
        alert('O e-mail não deve conter caracteres especiais, exceto . e @.');
        return;
    }

    var newAppointment = {
        nome: nome,
        email: email,
        datetime: datetime
    };

    var existingAppointmentsOnDay = appointments.filter(function(appointment) {
        var appointmentDateTime = new Date(appointment.datetime);
        var newAppointmentDateTime = new Date(datetime);
        return (
            appointmentDateTime.getFullYear() === newAppointmentDateTime.getFullYear() &&
            appointmentDateTime.getMonth() === newAppointmentDateTime.getMonth() &&
            appointmentDateTime.getDate() === newAppointmentDateTime.getDate()
        );
    });

    var time = datetime.split(' ')[1].split(':');
    var minutes = time[1];
    if (time[0] < 9 || time[0] >= 18 || (minutes !== '00' && minutes !== '30') || existingAppointmentsOnDay.some(function(appointment) {
        return appointment.datetime.split(' ')[1] === datetime.split(' ')[1];
    })) {
        alert('Por favor, escolha um horário entre 9h e 18h, em intervalos de 30 minutos ou em um horário disponível.');
        return;
    }

    appointments.push(newAppointment);

    localStorage.setItem('appointments', JSON.stringify(appointments));

    // Atualizar os horários disponíveis imediatamente
    updateAvailableTimes();
});

        function getAvailableTimes() {
            var times = [];
            for (var hour = 9; hour < 18; hour++) {
                times.push(formatTime(hour, 0));
                times.push(formatTime(hour, 30));
            }

            appointments.forEach(function(appointment) {
                var dateTimeComponents = appointment.datetime.split(' ');
                var date = dateTimeComponents[0];
                var time = dateTimeComponents[1];
                var index = times.indexOf(time);
                if (index > -1) {
                    times.splice(index, 1);
                }
            });

            return times;
        }

        function formatTime(hour, minutes) {
            return (hour < 10 ? '0' + hour : hour) + ':' + (minutes === 0 ? '00' : minutes);
        }

        function updateAvailableTimes() {
            var availableTimes = getAvailableTimes();
            var options = '';
            availableTimes.forEach(function(time) {
                options += '<option value="' + time + '">' + time + '</option>';
            });
            datetimepicker.innerHTML = options;
        }

        var list = document.getElementById('appointmentList');

        if (appointments) {
            appointments.forEach(function(appointment, index) {
                var listItem = document.createElement('li');
                var appointmentInfo = document.createElement('div');
                appointmentInfo.classList.add('appointment-info');
                var name = document.createElement('p');
                name.textContent = 'Nome completo: ' + appointment.nome;
                var email = document.createElement('p');
                email.textContent = 'E-mail: ' + appointment.email;
                var date = document.createElement('p');
                date.textContent = 'Data: ' + appointment.datetime.split(' ')[0];
                var time = document.createElement('p');
                time.textContent = 'Horário: ' + appointment.datetime.split(' ')[1];
                var deleteButton = document.createElement('button');
                deleteButton.textContent = 'Excluir';
                deleteButton.onclick = function() {
                    showConfirmation(index);
                };
                appointmentInfo.appendChild(name);
                appointmentInfo.appendChild(email);
                appointmentInfo.appendChild(date);
                appointmentInfo.appendChild(time);
                listItem.appendChild(appointmentInfo);
                listItem.appendChild(deleteButton);
                list.appendChild(listItem);
            });
        } else {
            var listItem = document.createElement('li');
            listItem.textContent = 'Nenhum agendamento encontrado.';
            list.appendChild(listItem);
        }

        function showConfirmation(index) {
            var confirmationMessage = document.getElementById('confirmationMessage');
            confirmationMessage.style.display = 'flex';
            var yesButton = document.getElementById('yesButton');
            yesButton.onclick = function() {
                confirmDelete(index);
            };
            var noButton = document.getElementById('noButton');
            noButton.onclick = cancelDelete;
        }

        function confirmDelete(index) {
            appointments.splice(index, 1);
            localStorage.setItem('appointments', JSON.stringify(appointments));
            location.reload();
        }

        function cancelDelete() {
            var confirmationMessage = document.getElementById('confirmationMessage');
            confirmationMessage.style.display = 'none';
        }
    </script>
</body>
</html>